openapi: 3.0.0
info:
  title: Backend API
  description: API to manage AppInstalls, Licenses and Tenant Registrations
  version: 1.0.0

tags:
  - name: Feature Flags
  - name: Auth
  - name: Admin
  - name: App Installs
  - name: App Installs Requests
  - name: Licenses
  - name: licenses Renewal Requests
  - name: Loans
  - name: Market

paths:
  /feature-flags:
    get:
      tags: [Feature Flags]
      summary: Get feature flags
      operationId: getFeatureFlags
      responses:
        '200':
          description: A list of feature flags
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeatureFlags'
        '500':
          $ref: '#/components/responses/InternalError'
  /login-links:
    get:
      tags: [Auth]
      summary: Get list of links that initiate login
      operationId: listLinks
      responses:
        '200':
          description: Links that initiate login flows
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LoginLink'
        '500':
          $ref: '#/components/responses/InternalError'

  /user:
    get:
      tags: [Auth]
      summary: Get Authenticated User
      operationId: getAuthenticatedUser
      responses:
        '200':
          description: Current authenticated user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthenticatedUser'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/tenant-registrations:
    get:
      tags: [Admin]
      summary: List all Tenant Registrations
      operationId: listTenantRegistrations
      responses:
        '200':
          description: A list of Tenant Registrations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TenantRegistration'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      tags: [Admin]
      summary: Create Tenant Registration
      operationId: createTenantRegistration
      requestBody:
        description: Tenant Registration object
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantRegistrationRequest'
            examples:
              oauth2:
                value:
                  tenantId: "tenant-123"
                  partyId: "party-abc"
                  walletUrl: "http://wallet.localhost:2000/"
                  clientId: "client-xyz"
                  issuerUrl: "http://keycloak.localhost:8082/realms/AppProvider"
                  internal: false
              sharedSecret:
                value:
                  tenantId: "tenant-ss"
                  partyId: "party-ss"
                  walletUrl: "http://wallet.localhost:2000/"
                  users: [ "alice","bob" ]
                  internal: true
      responses:
        '201':
          description: Registration created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantRegistration'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/tenant-registrations/{tenantId}:
    delete:
      tags: [Admin]
      summary: Delete Tenant Registration
      operationId: deleteTenantRegistration
      parameters:
        - $ref: '#/components/parameters/TenantId'
      responses:
        '204':
          description: Tenant registration deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /app-install-requests:
    get:
      tags: [App Installs Requests]
      summary: List all AppInstallRequests
      operationId: listAppInstallRequests
      responses:
        '200':
          description: A list of AppInstallRequests
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AppInstallRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /app-install-requests/{contractId}:accept:
    post:
      tags: [App Installs Requests]
      summary: Accept an AppInstallRequest
      operationId: acceptAppInstallRequest
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        description: Acceptance parameters
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppInstallRequestAccept'
      responses:
        '201':
          description: AppInstall created from request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppInstall'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /app-install-requests/{contractId}:reject:
    post:
      tags: [App Installs Requests]
      summary: Reject an AppInstallRequest
      operationId: rejectAppInstallRequest
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        description: Rejection parameters
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppInstallRequestReject'
      responses:
        '204':
          description: AppInstallRequest rejected
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /app-installs:
    get:
      tags: [ App Installs ]
      summary: List all AppInstalls
      operationId: listAppInstalls
      responses:
        '200':
          description: A list of AppInstalls
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AppInstall'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /app-installs/{contractId}:create-license:
    post:
      tags: [App Installs]
      summary: Create a License using the AppInstall
      operationId: createLicense
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        description: License creation parameters
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppInstallCreateLicenseRequest'
      responses:
        '201':
          description: License created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppInstallCreateLicenseResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /app-installs/{contractId}:cancel:
    post:
      tags: [App Installs]
      summary: Cancel an AppInstall
      operationId: cancelAppInstall
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        description: Cancellation parameters
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppInstallCancel'
      responses:
        '204':
          description: AppInstall canceled
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /licenses:
    get:
      tags: [Licenses]
      summary: List all Licenses (including renewal requests)
      operationId: listLicenses
      responses:
        '200':
          description: A list of Licenses
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/License'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /licenses/{contractId}:renew:
    post:
      tags: [Licenses]
      summary: Renew a License
      operationId: renewLicense
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        description: License renewal parameters
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LicenseRenewRequest'
      responses:
        '201':
          description: Renewal offer/payment request created
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /licenses/{contractId}:complete-renewal:
    post:
      tags: [Licenses]
      summary: Complete the License Renewal
      operationId: completeLicenseRenewal
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        description: Complete license renewal parameters
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompleteLicenseRenewalRequest'
      responses:
        '200':
          description: License renewed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LicenseRenewalResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /licenses/{contractId}:expire:
    post:
      tags: [Licenses]
      summary: Expire a License
      operationId: expireLicense
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        description: Expiration parameters
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LicenseExpireRequest'
      responses:
        '200':
          description: License expired
          content:
            text/plain:
              schema:
                type: string
                nullable: true
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /license-renewal-requests/{contractId}:withdraw:
    post:
      tags: [licenses Renewal Requests]
      summary: Withdraw an LicenseRenewalRequest
      operationId: withdrawLicenseRenewalRequest
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      responses:
        '204':
          description: LicenseRenewalRequest withdrawn
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/request:
    post:
      tags: [Loans]
      summary: Create a loan request (borrower)
      operationId: createLoanRequest
      parameters:
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoanRequestCreate'
      responses:
        '201':
          description: Loan request created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/offer:
    post:
      tags: [Loans]
      summary: Create a loan offer (lender)
      operationId: createLoanOffer
      parameters:
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoanOfferCreate'
      responses:
        '201':
          description: Loan offer created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanOffer'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/offers/{contractId}/fund:
    post:
      tags: [Loans]
      summary: Accept loan offer / fund loan (borrower)
      operationId: fundLoan
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoanFundRequest'
      responses:
        '200':
          description: Loan funded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanFundResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/offer/{contractId}:accept-with-token:
    post:
      tags: [Loans]
      summary: Accept loan offer with token settlement (borrower)
      operationId: acceptLoanOfferWithToken
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AcceptOfferWithTokenRequest'
      responses:
        '201':
          description: Funding intent created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FundingIntentResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/funding-intent/{contractId}:confirm:
    post:
      tags: [Loans]
      summary: Confirm a funding intent (lender)
      operationId: confirmFundingIntent
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      responses:
        '201':
          description: Loan principal request created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanPrincipalRequestResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/funding-intents:
    get:
      tags: [Loans]
      summary: List funding intents visible to the authenticated party
      operationId: listFundingIntents
      responses:
        '200':
          description: List of funding intents
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LoanFundingIntent'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/principal-requests:
    get:
      tags: [Loans]
      summary: List loan principal requests (lender)
      operationId: listPrincipalRequests
      responses:
        '200':
          description: List of loan principal requests
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LoanPrincipalRequestSummary'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/principal-requests/{contractId}:complete-funding:
    post:
      tags: [Loans]
      summary: Complete token funding for a loan principal request (lender)
      operationId: completeLoanFunding
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompleteLoanFundingRequest'
      responses:
        '200':
          description: Loan funded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanFundResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/{contractId}/repay:
    post:
      tags: [Loans]
      summary: Repay a loan (borrower)
      operationId: repayLoan
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      responses:
        '200':
          description: Loan repaid
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/{contractId}:mark-default:
    post:
      tags: [Loans]
      summary: Mark a loan as defaulted (lender)
      operationId: markLoanDefault
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      responses:
        '200':
          description: Loan marked as defaulted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/{contractId}:request-repayment:
    post:
      tags: [Loans]
      summary: Request token-based repayment (borrower)
      operationId: requestLoanRepayment
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestRepaymentRequest'
      responses:
        '201':
          description: Repayment request created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanRepaymentRequestResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/repayment-requests:
    get:
      tags: [Loans]
      summary: List loan repayment requests visible to the authenticated party
      operationId: listRepaymentRequests
      responses:
        '200':
          description: List of loan repayment requests
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LoanRepaymentRequestSummary'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans/repayment-requests/{contractId}:complete-repayment:
    post:
      tags: [Loans]
      summary: Complete token-based repayment (lender)
      operationId: completeLoanRepayment
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompleteLoanRepaymentRequest'
      responses:
        '200':
          description: Loan repayment completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanRepaymentResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /loan-requests:
    get:
      tags: [Loans]
      summary: List loan requests (borrower)
      operationId: listLoanRequests
      responses:
        '200':
          description: List of loan requests
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LoanRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /loan-offers:
    get:
      tags: [Loans]
      summary: List loan offers visible to the authenticated party (lender or borrower)
      operationId: listLoanOffers
      responses:
        '200':
          description: List of loan offers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LoanOffer'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /loans:
    get:
      tags: [Loans]
      summary: List loans visible to the authenticated party
      operationId: listLoans
      responses:
        '200':
          description: List of loans
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Loan'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /platform-stats:
    get:
      tags: [Loans]
      summary: Aggregate platform statistics computed from on-ledger data
      operationId: getPlatformStats
      responses:
        '200':
          description: Platform statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlatformStats'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /credit-profile:
    get:
      tags: [Loans]
      summary: Get credit profile for the authenticated party (borrower)
      operationId: getCreditProfile
      responses:
        '200':
          description: Credit profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreditProfile'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /market/lender-bids:
    get:
      tags: [Market]
      summary: List active lender bids
      operationId: listLenderBids
      responses:
        '200':
          description: A list of active lender bids
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LenderBidResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      tags: [Market]
      summary: Create a lender bid
      operationId: createLenderBid
      parameters:
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LenderBidCreate'
      responses:
        '201':
          description: Lender bid created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LenderBidResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /market/lender-bids/{contractId}:
    delete:
      tags: [Market]
      summary: Cancel a lender bid
      operationId: cancelLenderBid
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      responses:
        '204':
          description: Lender bid cancelled
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /market/borrower-asks:
    get:
      tags: [Market]
      summary: List active borrower asks
      operationId: listBorrowerAsks
      responses:
        '200':
          description: A list of active borrower asks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BorrowerAskResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      tags: [Market]
      summary: Create a borrower ask
      operationId: createBorrowerAsk
      parameters:
        - $ref: '#/components/parameters/CommandId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BorrowerAskCreate'
      responses:
        '201':
          description: Borrower ask created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BorrowerAskResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /market/borrower-asks/{contractId}:
    delete:
      tags: [Market]
      summary: Cancel a borrower ask
      operationId: cancelBorrowerAsk
      parameters:
        - $ref: '#/components/parameters/ContractId'
        - $ref: '#/components/parameters/CommandId'
      responses:
        '204':
          description: Borrower ask cancelled
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /market/match:
    post:
      tags: [Market]
      summary: Manually trigger order matching (admin/platform)
      operationId: triggerMatch
      parameters:
        - $ref: '#/components/parameters/CommandId'
      responses:
        '200':
          description: Matching cycle completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

components:
  parameters:
    ContractId:
      name: contractId
      in: path
      required: true
      description: Ledger contract ID
      schema:
        type: string
    CommandId:
      name: commandId
      in: query
      required: true
      description: The command ID for the ledger transaction
      schema:
        type: string
    TenantId:
      name: tenantId
      in: path
      required: true
      description: Tenant identifier
      schema:
        type: string
  responses:
    BadRequest:
      description: Invalid request
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Not authenticated
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Forbidden
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Resource not found
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: Conflict with current state of the resource
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalError:
      description: An internal server error occurred
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
  schemas:
    TenantRegistrationRequest:
      type: object
      required:
        - tenantId
        - partyId
        - walletUrl
      properties:
        tenantId:
          type: string
        partyId:
          type: string
        walletUrl:
          type: string
        clientId:
          type: string
          description: Required when authMode is oauth2
        issuerUrl:
          type: string
          description: Required when authMode is oauth2
        users:
          type: array
          description: Required (non-empty) when authMode is shared-secret
          items:
            type: string

    TenantRegistration:
      type: object
      required:
        - tenantId
        - partyId
        - walletUrl
        - internal
      properties:
        tenantId:
          type: string
          description: Tenant identifier
        partyId:
          type: string
          description: Party identifier
        walletUrl:
          type: string
          description: Wallet URL for payment redirects
          format: uri
        clientId:
          type: string
          description: OAuth2 client identifier
        issuerUrl:
          type: string
          description: Issuer URL
          format: uri
        internal:
          type: boolean
          description: Internal registration
        users:
          type: array
          items:
            type: string
    AuthenticatedUser:
      type: object
      required:
        - name
        - party
        - roles
        - isAdmin
        - walletUrl
      properties:
        name:
          type: string
        party:
          type: string
        roles:
          type: array
          items:
            type: string
        isAdmin:
          type: boolean
        walletUrl:
          type: string

    LoginLink:
      type: object
      required:
        - name
        - url
      properties:
        name:
          type: string
        url:
          type: string

    AppInstallRequest:
      type: object
      required:
        - contractId
        - provider
        - user
        - meta
      properties:
        contractId:
          type: string
        provider:
          type: string
        user:
          type: string
        meta:
          $ref: '#/components/schemas/Metadata'

    AppInstallRequestAccept:
      type: object
      required:
        - installMeta
        - meta
      properties:
        installMeta:
          $ref: '#/components/schemas/Metadata'
        meta:
          $ref: '#/components/schemas/Metadata'

    AppInstallRequestReject:
      type: object
      required:
        - meta
      properties:
        meta:
          $ref: '#/components/schemas/Metadata'

    AppInstallRequestCancel:
      type: object
      required:
        - meta
      properties:
        meta:
          $ref: '#/components/schemas/Metadata'

    AppInstall:
      type: object
      required:
        - contractId
        - provider
        - user
        - meta
        - numLicensesCreated
        - licenseNum
      properties:
        contractId:
          type: string
        provider:
          type: string
        user:
          type: string
        meta:
          $ref: '#/components/schemas/Metadata'
        numLicensesCreated:
          type: integer
        licenseNum:
          type: integer

    AppInstallCreateLicenseRequest:
      type: object
      required:
        - params
      properties:
        params:
          $ref: '#/components/schemas/LicenseParams'

    AppInstallCreateLicenseResult:
      type: object
      properties:
        installId:
          type: string
        licenseId:
          type: string

    AppInstallCancel:
      type: object
      required:
        - meta
      properties:
        meta:
          $ref: '#/components/schemas/Metadata'

    LicenseParams:
      type: object
      properties:
        meta:
          $ref: '#/components/schemas/Metadata'

    License:
      type: object
      required:
        - contractId
        - provider
        - user
        - params
        - expiresAt
        - licenseNum
        - isExpired
      properties:
        contractId:
          type: string
        provider:
          type: string
        user:
          type: string
        params:
          $ref: '#/components/schemas/LicenseParams'
        expiresAt:
          type: string
          format: date-time
        licenseNum:
          type: integer
        isExpired:
          type: boolean
        renewalRequests:
          type: array
          items:
            $ref: '#/components/schemas/LicenseRenewalRequest'

    Metadata:
      type: object
      properties:
        data:
          type: object
          additionalProperties:
            type: string

    LicenseRenewRequest:
      type: object
      description: Parameters used to initiate a license renewal.
      required:
        - licenseFeeCc
        - licenseExtensionDuration
        - prepareUntilDuration
        - settleBeforeDuration
        - description
      properties:
        licenseFeeCc:
          type: number
          description: License fee amount
        licenseExtensionDuration:
          type: string
          description: "ISO-8601 duration specifying the requested extension period (e.g. 'P30D' for 30 days)."
        prepareUntilDuration:
          type: string
          description: "ISO-8601 duration after which the allocation request will be not accepted."
        settleBeforeDuration:
          type: string
          description: "ISO-8601 duration within which the transfer must be settled."
        description:
          type: string
          description: Human-readable explanation of the renewal request.

    LicenseRenewalResult:
      type: object
      properties:
        licenseId:
          type: string

    LicenseRenewalRequest:
      type: object
      required:
          - contractId
          - provider
          - user
          - licenseNum
          - licenseFeeAmount
          - licenseFeeInstrument
          - licenseExtensionDuration
          - prepareUntil
          - settleBefore
          - requestedAt
          - description
          - requestId
          - prepareDeadlinePassed
          - settleDeadlinePassed
      properties:
        contractId:
          type: string
        provider:
          type: string
        user:
          type: string
        licenseNum:
          type: integer
        licenseFeeAmount:
          type: number
        licenseFeeInstrument:
          type: string
        licenseExtensionDuration:
          type: string
          description: "RelTime representing how long the license should be extended."
        prepareUntil:
            type: string
            format: date-time
            description: "The time until the license renewal request can be prepared."
        settleBefore:
            type: string
            format: date-time
            description: "The time before which the payment must be settled."
        requestedAt :
          type: string
          format: date-time
          description: "The time until the license renewal request can be prepared."
        description:
          type: string
        requestId:
          type: string
        allocationCid:
          type: string
        prepareDeadlinePassed:
          type: boolean
        settleDeadlinePassed:
          type: boolean

    LicenseExpireRequest:
      type: object
      required:
        - meta
      properties:
        meta:
          $ref: '#/components/schemas/Metadata'

    CompleteLicenseRenewalRequest:
      type: object
      required:
        - renewalRequestContractId
        - allocationContractId
      properties:
        renewalRequestContractId:
          type: string
          description: The contract ID of the LicenseRenewalRequest to complete
        allocationContractId:
          type: string
          description: The contract ID of the accepted allocation

    FeatureFlags:
      type: object
      properties:
        authMode:
          type: string
          enum:
            - oauth2
            - shared-secret

    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          nullable: true
          example: "TenantId is required"

    LoanRequestCreate:
      type: object
      required: [ amount, interestRate, durationDays, purpose ]
      properties:
        amount:
          type: number
          format: double
        interestRate:
          type: number
          format: double
        durationDays:
          type: integer
        purpose:
          type: string

    LoanRequest:
      type: object
      required: [ contractId, borrower, amount, interestRate, durationDays, purpose, createdAt ]
      properties:
        contractId:
          type: string
        underlyingRequestContractId:
          type: string
          description: When this row is from a disclosed view (LoanRequestForLender), the underlying LoanRequest contract id. Used so UI can match offers (which reference this id) to requests.
        borrower:
          type: string
        amount:
          type: number
        interestRate:
          type: number
        durationDays:
          type: integer
        purpose:
          type: string
        createdAt:
          type: string
          format: date-time

    LoanOfferCreate:
      type: object
      required: [ loanRequestId, amount, interestRate ]
      properties:
        loanRequestId:
          type: string
        amount:
          type: number
        interestRate:
          type: number
        durationDays:
          type: integer
          description: Loan term in days (lender-proposed). If omitted, uses the request's duration.

    LoanOffer:
      type: object
      required: [ contractId, lender, borrower, amount, interestRate, durationDays, createdAt ]
      properties:
        contractId:
          type: string
        loanRequestId:
          type: string
          description: Contract ID of the loan request this offer is for (so UI can hide it from "requests to fund").
        lender:
          type: string
        borrower:
          type: string
        amount:
          type: number
        interestRate:
          type: number
        durationDays:
          type: integer
        createdAt:
          type: string
          format: date-time

    LoanFundRequest:
      type: object
      required: [ creditProfileId ]
      properties:
        creditProfileId:
          type: string

    LoanFundResult:
      type: object
      properties:
        loanId:
          type: string

    AcceptOfferWithTokenRequest:
      type: object
      required: [creditProfileId]
      properties:
        creditProfileId:
          type: string
        requestId:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        prepareUntilDuration:
          type: string
          description: ISO-8601 duration until allocation window closes (e.g. PT2H)
          nullable: true
        settleBeforeDuration:
          type: string
          description: ISO-8601 duration until settlement deadline (e.g. PT24H)
          nullable: true

    FundingIntentResult:
      type: object
      properties:
        fundingIntentId:
          type: string

    LoanPrincipalRequestResult:
      type: object
      properties:
        principalRequestId:
          type: string

    CompleteLoanFundingRequest:
      type: object
      required: [allocationContractId]
      properties:
        allocationContractId:
          type: string

    LoanFundingIntent:
      type: object
      required:
        [contractId, requestId, lender, borrower, principal, interestRate, durationDays, prepareUntil, settleBefore, requestedAt, loanRequestId, offerContractId, creditProfileId]
      properties:
        contractId:
          type: string
        requestId:
          type: string
        lender:
          type: string
        borrower:
          type: string
        principal:
          type: number
        interestRate:
          type: number
        durationDays:
          type: integer
        prepareUntil:
          type: string
          format: date-time
        settleBefore:
          type: string
          format: date-time
        requestedAt:
          type: string
          format: date-time
        description:
          type: string
          nullable: true
        loanRequestId:
          type: string
        offerContractId:
          type: string
        creditProfileId:
          type: string

    LoanPrincipalRequestSummary:
      type: object
      required:
        [contractId, requestId, lender, borrower, principal, interestRate, durationDays, prepareUntil, settleBefore, requestedAt, loanRequestId, offerContractId, creditProfileId]
      properties:
        contractId:
          type: string
        requestId:
          type: string
        lender:
          type: string
        borrower:
          type: string
        principal:
          type: number
        interestRate:
          type: number
        durationDays:
          type: integer
        prepareUntil:
          type: string
          format: date-time
        settleBefore:
          type: string
          format: date-time
        requestedAt:
          type: string
          format: date-time
        description:
          type: string
          nullable: true
        loanRequestId:
          type: string
        offerContractId:
          type: string
        creditProfileId:
          type: string
        allocationCid:
          type: string
          nullable: true
        prepareDeadlinePassed:
          type: boolean
        settleDeadlinePassed:
          type: boolean

    RequestRepaymentRequest:
      type: object
      properties:
        requestId:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        prepareUntilDuration:
          type: string
          description: ISO-8601 duration until allocation window closes (e.g. PT2H)
          nullable: true
        settleBeforeDuration:
          type: string
          description: ISO-8601 duration until settlement deadline (e.g. PT24H)
          nullable: true

    LoanRepaymentRequestResult:
      type: object
      properties:
        repaymentRequestId:
          type: string

    CompleteLoanRepaymentRequest:
      type: object
      required: [allocationContractId]
      properties:
        allocationContractId:
          type: string

    LoanRepaymentRequestSummary:
      type: object
      required:
        [contractId, requestId, lender, borrower, repaymentAmount, prepareUntil, settleBefore, requestedAt, loanContractId, creditProfileId]
      properties:
        contractId:
          type: string
        requestId:
          type: string
        lender:
          type: string
        borrower:
          type: string
        repaymentAmount:
          type: number
        prepareUntil:
          type: string
          format: date-time
        settleBefore:
          type: string
          format: date-time
        requestedAt:
          type: string
          format: date-time
        description:
          type: string
          nullable: true
        loanContractId:
          type: string
        creditProfileId:
          type: string
        allocationCid:
          type: string
          nullable: true
        prepareDeadlinePassed:
          type: boolean
        settleDeadlinePassed:
          type: boolean

    LoanRepaymentResult:
      type: object
      properties:
        creditProfileId:
          type: string

    Loan:
      type: object
      required: [ contractId, lender, borrower, principal, interestRate, dueDate, status ]
      properties:
        contractId:
          type: string
        lender:
          type: string
        borrower:
          type: string
        principal:
          type: number
        interestRate:
          type: number
        dueDate:
          type: string
          format: date-time
        status:
          type: string
          enum: [ Active, Repaid, Defaulted ]

    CreditProfile:
      type: object
      required: [ contractId, borrower, creditScore, totalLoans, successfulLoans, defaultedLoans ]
      properties:
        contractId:
          type: string
        borrower:
          type: string
        creditScore:
          type: integer
        totalLoans:
          type: integer
        successfulLoans:
          type: integer
        defaultedLoans:
          type: integer
        createdAt:
          type: string
          format: date-time

    LenderBidCreate:
      type: object
      required: [ amount, minInterestRate, maxDuration ]
      properties:
        amount:
          type: number
          format: double
        minInterestRate:
          type: number
          format: double
        maxDuration:
          type: integer

    PlatformStats:
      type: object
      required: [ totalValueLocked, totalLoansOriginated, averageInterestRate, activeLoans, totalLenders, totalBorrowers ]
      properties:
        totalValueLocked:
          type: number
          description: Sum of principals for all currently active loans
        totalLoansOriginated:
          type: number
          description: Total number of loans ever created (active + repaid + defaulted)
        averageInterestRate:
          type: number
          description: Average interest rate across all active loans
        activeLoans:
          type: integer
          description: Number of currently active loans
        totalLenders:
          type: integer
          description: Number of distinct lender parties with active loans
        totalBorrowers:
          type: integer
          description: Number of distinct borrower parties with active loans

    LenderBidResponse:
      type: object
      required: [ contractId, lender, amount, remainingAmount, minInterestRate, maxDuration, createdAt ]
      properties:
        contractId:
          type: string
        lender:
          type: string
        amount:
          type: number
        remainingAmount:
          type: number
        minInterestRate:
          type: number
        maxDuration:
          type: integer
        createdAt:
          type: string
          format: date-time

    BorrowerAskCreate:
      type: object
      required: [ amount, maxInterestRate, duration, creditProfileId ]
      properties:
        amount:
          type: number
          format: double
        maxInterestRate:
          type: number
          format: double
        duration:
          type: integer
        creditProfileId:
          type: string

    BorrowerAskResponse:
      type: object
      required: [ contractId, borrower, amount, maxInterestRate, duration, createdAt ]
      properties:
        contractId:
          type: string
        borrower:
          type: string
        amount:
          type: number
        maxInterestRate:
          type: number
        duration:
          type: integer
        createdAt:
          type: string
          format: date-time

    MatchResult:
      type: object
      properties:
        matchesCreated:
          type: integer
        message:
          type: string
